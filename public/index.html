<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zulu Flight Time Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 0 12px;
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input, select, button {
      margin-top: 4px;
      padding: 6px;
      font-size: 14px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
    }
    td, th {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    h2 {
      margin-top: 28px;
    }
    .note {
      font-size: 13px;
      color: #444;
      margin-top: 6px;
    }
  </style>
</head>
<body>

<h1>Flight Time Calculator (Zulu)</h1>

<label>
  Takeoff ICAO:
  <input id="to_icao" placeholder="EGUL" />
</label>

<label>
  Takeoff Time (HHMM):
  <input id="to_time" placeholder="1200" />
  <select id="to_ref">
    <option value="Z">Zulu</option>
    <option value="L">Local</option>
  </select>
</label>

<label>
  Landing ICAO:
  <input id="ld_icao" placeholder="EDDF" />
</label>

<label>
  Landing Time (HHMM):
  <input id="ld_time" placeholder="1525" />
  <select id="ld_ref">
    <option value="Z">Zulu</option>
    <option value="L">Local</option>
  </select>
</label>

<div class="note">
  All outputs are shown in <b>Zulu time</b>. Local time will be reintroduced later.
</div>

<br />
<button onclick="calculate()">Calculate</button>

<div id="output"></div>

<script>
const WORKER_URL = "https://old-surf-349b.calvincraig.workers.dev/convert";

function formatZulu(mins) {
  mins = ((mins % 1440) + 1440) % 1440;
  const h = Math.floor(mins / 60).toString().padStart(2, "0");
  const m = (mins % 60).toString().padStart(2, "0");
  return `${h}${m}Z`;
}

async function getZuluFromWorker(icao, time, ref) {
  const response = await fetch(
    `${WORKER_URL}?icao=${encodeURIComponent(icao)}&time=${encodeURIComponent(time)}&ref=${encodeURIComponent(ref)}`
  );

  if (!response.ok) {
    throw new Error("Worker error");
  }

  const data = await response.json();
  return data.zuluMinutes;
}

async function calculate() {
  try {
    const toICAO = document.getElementById("to_icao").value.trim().toUpperCase();
    const ldICAO = document.getElementById("ld_icao").value.trim().toUpperCase();
    const toTime = document.getElementById("to_time").value.trim();
    const ldTime = document.getElementById("ld_time").value.trim();
    const toRef = document.getElementById("to_ref").value;
    const ldRef = document.getElementById("ld_ref").value;

    if (!toICAO || !ldICAO) {
      document.getElementById("output").textContent =
        "Please enter both ICAO codes.";
      return;
    }

    if (!/^\d{4}$/.test(toTime) || !/^\d{4}$/.test(ldTime)) {
      document.getElementById("output").textContent =
        "Times must be entered as HHMM.";
      return;
    }

    const toZulu = await getZuluFromWorker(toICAO, toTime, toRef);
    let ldZulu = await getZuluFromWorker(ldICAO, ldTime, ldRef);

    if (ldZulu < toZulu) {
      ldZulu += 1440;
    }

    const flightMinutes = ldZulu - toZulu;
    const flightHours = (flightMinutes / 60).toFixed(1);

    const showTime = toZulu - 195;

    const timeline = [
      { label: "Enter Crew Rest", time: toZulu - 975 },
      { label: "Last Beer ðŸº", time: toZulu - 720 },
      { label: "Legal for Alert", time: toZulu - 255 },
      { label: "Show Time", time: showTime },
      { label: "Brief Time", time: toZulu - 150 },
      { label: "Step Time", time: toZulu - 120 },
      { label: "Engine Start", time: toZulu - 30 },
      { label: "Takeoff Time", time: toZulu },
      { label: "Estimated Land Time", time: ldZulu }
    ];

    const dutyLimits = [
      { label: "Flight Duty Ends", time: showTime + 960 }
