<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crew Dawg Calculator</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f7fa;
  margin:0;
  padding:20px;
  color:#222;
}

.app{
  width:100%;
  max-width:560px;
  margin:0 auto;
  padding:10px;
}

h1{
  text-align:center;
  margin:10px 0 18px;
}

/* ---------- TOP FORM (GRID) ---------- */
.form-grid{
  display:grid;
  row-gap:14px;
}

/* Each row shares the SAME columns so everything aligns */
.form-row{
  display:grid;
  grid-template-columns: 190px 92px 34px 92px 1fr;
  align-items:center;
  column-gap:8px;
  width:100%;
  font-weight:bold;
}

/* label column */
.form-row .label{
  white-space:nowrap;
}

/* HHMM + corner Z */
.time-wrap{
  position:relative;
  display:inline-block;
  width:92px;
}
.time-input{
  width:92px;
  padding:6px;
  font-size:16px;
  text-align:center;
  box-sizing:border-box;
}
.z-badge{
  position:absolute;
  right:6px;
  bottom:3px;
  font-size:10px;
  font-weight:normal;
  color:#666;
  pointer-events:none;
}

/* small "at" */
.at{
  font-weight:bold;
}

/* ICAO input */
.icao-input{
  width:92px;
  padding:6px;
  font-size:16px;
  text-transform:uppercase;
  text-align:center;
  box-sizing:border-box;
}

/* third row content spans the non-label columns */
.third-content{
  /* IMPORTANT: this is now a DIRECT child of .form-row (see Row 3 HTML) */
  grid-column: 3 / 6; /* starts under the "at" column and spans to the end */
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  font-weight:normal;
}

/* aircraft select */
#aircraft{
  padding:6px;
  font-size:16px;
  width:48%;
  max-width:240px;
  box-sizing:border-box;
}

/* toggle */
.crew-toggle{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:10px;
  width:52%;
  min-width:230px;
}

.crew-label{
  font-weight:normal;
  color:#333;
}
.crew-label.active{
  font-weight:bold;
}

/* switch */
.switch{
  position:relative;
  width:52px;
  height:26px;
  flex:0 0 auto;
}
.switch input{ display:none; }

.slider{
  position:absolute;
  inset:0;
  background:#d0d0d0;
  border-radius:26px;
}
.slider:before{
  content:"◀";
  position:absolute;
  height:22px;
  width:22px;
  left:2px;
  top:2px;
  background:#fff;
  border-radius:50%;
  display:grid;
  place-items:center;
  font-size:12px;
  color:#444;
  transition:0.25s;
  box-shadow:0 1px 2px rgba(0,0,0,0.2);
}
input:checked + .slider:before{
  transform:translateX(26px);
  content:"▶";
}

/* ---------- BUTTON ---------- */
button{
  margin-top:20px;
  padding:12px;
  font-size:16px;
  width:100%;
  cursor:pointer;
}

/* ---------- OUTPUT ---------- */
.output{
  margin-top:28px;
  padding:20px;
  background:white;
  border-radius:8px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin-top:12px;
  font-weight:bold;
}

.subtext{
  font-size:12px;
  color:#666;
  margin-top:2px;
  margin-bottom:6px;
}

.warn{
  background-color:#fff3cd;
  padding:4px 6px;
  border-radius:4px;
}

.danger{
  background-color:#f8d7da;
  padding:4px 6px;
  border-radius:4px;
}

/* ---------- DISCLAIMER ---------- */
.disclaimer{
  margin-top:40px;
  font-size:13px;
  color:#444;
  line-height:1.5;
  text-align:justify;
  text-justify:inter-word;
}

/* ---------- FOOTER ---------- */
.footer{
  margin-top:40px;
  text-align:center;
  font-weight:bold;
}
.footer small{
  display:block;
  font-weight:normal;
  color:#666;
}
</style>
</head>

<body>
<div class="app">

<h1>Crew Dawg Calculator</h1>

<div class="form-grid">

  <!-- Row 1 -->
  <div class="form-row">
    <div class="label">Scheduled Takeoff Time:</div>

    <div class="time-wrap">
      <input id="takeoffTime" class="time-input" placeholder="HHMM" maxlength="4">
      <span class="z-badge">Z</span>
    </div>

    <div class="at">at</div>

    <input id="takeoffICAO" class="icao-input" placeholder="ICAO" maxlength="4">

    <div></div>
  </div>

  <!-- Row 2 -->
  <div class="form-row">
    <div class="label">Scheduled Land Time:</div>

    <div class="time-wrap">
      <input id="landingTime" class="time-input" placeholder="HHMM" maxlength="4">
      <span class="z-badge">Z</span>
    </div>

    <div class="at">at</div>

    <input id="landingICAO" class="icao-input" placeholder="ICAO" maxlength="4">

    <div></div>
  </div>

  <!-- Row 3 (FIXED ALIGNMENT) -->
  <div class="form-row">
    <div class="label"></div>

    <div></div> <!-- spacer for the time column so the grid stays consistent -->

    <div class="third-content">
      <select id="aircraft">
        <option selected>KC-135</option>
        <option>KC-46</option>
        <option>C-5</option>
        <option>C-17</option>
        <option>C-130</option>
        <option>C-21</option>
        <option>C-32</option>
        <option>C-37</option>
        <option>C-40</option>
        <option>VC-25</option>
      </select>

      <div class="crew-toggle">
        <span id="basicLbl" class="crew-label active">Basic</span>
        <label class="switch">
          <input type="checkbox" id="augmented">
          <span class="slider"></span>
        </label>
        <span id="augLbl" class="crew-label">Augmented</span>
      </div>
    </div>
  </div>

</div>

<button id="calcBtn">Calculate</button>

<div id="output" class="output"></div>

<div class="disclaimer">
  <p><strong>Disclaimer:</strong> I am a crew dog, not a coder. I created this tool to try and help other crew dogs do “pilot math.” I try to keep this up to date with current regulations, but there is no guarantee of its accuracy. Please make sure you <em>trust but verify</em> the information generated on this page (technique only). Information in this calculator is based on AFMAN 11-202V3_AMC SUP, 29 JULY 2024.</p>

  <p>Also, as much as I would like to take credit for this and lead you to think I am smart, I created this tool with the help of ChatGPT. If you find an error, please let me know at <strong>[your email]</strong>.</p>

  <p><strong>Donations:</strong> This tool is free for you to use to help manage your crew. It costs you nothing and costs me a little time. If you feel so inclined to make a donation, please pay it forward and buy your Crew Chief a beer on the next TDY… or just make the Copilot do it. I appreciate your consideration, but I have already taken the bonus, so I am screwed either way. Cheers!</p>
</div>

<div class="footer">
  NKAWT...GF
  <small>(If you know, you know…)</small>
</div>

<script>
function hhmmToMinutes(hhmm){
  return parseInt(hhmm.slice(0,2))*60 + parseInt(hhmm.slice(2,4));
}

function minutesToHHMM(mins){
  mins = ((mins % 1440) + 1440) % 1440;
  return String(Math.floor(mins/60)).padStart(2,"0") +
         String(mins%60).padStart(2,"0") + "Z";
}

function diffMinutes(start, end){
  let d = end - start;
  if(d < 0) d += 1440;
  return d;
}

function calculate(){
  const takeoff = takeoffTime.value;
  const landing = landingTime.value;
  const augmented = augmentedBox.checked;
  const out = document.getElementById("output");

  if(takeoff.length !== 4 || landing.length !== 4){
    out.innerHTML = "Please enter times in HHMM format.";
    return;
  }

  const takeoffMin = hhmmToMinutes(takeoff);
  const landingMin = hhmmToMinutes(landing);
  const showTime = takeoffMin - 195;

  const crewRest   = takeoffMin - 855;
  const lastBeer   = takeoffMin - 720;
  const legalAlert = takeoffMin - 255;
  const briefTime  = takeoffMin - 150;
  const stepTime   = takeoffMin - 120;
  const engine     = takeoffMin - 30;

  const flightMin = diffMinutes(takeoffMin, landingMin);
  const flightHrs = (flightMin/60).toFixed(1);

  // KC-135 rules (for now)
  const fdp = augmented ? 1440 : 960;   // 24 vs 16
  const cdp = augmented ? 1485 : 1080;  // 24:45 vs 18
  const tdp = 720;                      // 12 (unchanged)
  const apu = augmented ? 1080 : 720;   // 18 vs 12

  const landingFromShow = diffMinutes(showTime, landingMin);

  function hl(limitMinutes){
    if(landingFromShow > limitMinutes) return "danger";
    if(landingFromShow >= limitMinutes * 0.8) return "warn";
    return "";
  }

  out.innerHTML = `
    <div class="row"><span>Enter Crew Rest</span><span>${minutesToHHMM(crewRest)}</span></div>
    <div class="subtext">T/O − 14+15</div>

    <div class="row"><span>Last Beer</span><span>${minutesToHHMM(lastBeer)}</span></div>
    <div class="subtext">T/O − 12+00</div>

    <div class="row"><span>Legal for Alert</span><span>${minutesToHHMM(legalAlert)}</span></div>
    <div class="subtext">T/O − 4+15</div>

    <div class="row"><span>Show Time</span><span>${minutesToHHMM(showTime)}</span></div>
    <div class="subtext">T/O − 3+15</div>

    <div class="row"><span>Brief Time</span><span>${minutesToHHMM(briefTime)}</span></div>
    <div class="subtext">T/O − 2+30</div>

    <div class="row"><span>Step Time</span><span>${minutesToHHMM(stepTime)}</span></div>
    <div class="subtext">T/O − 2+00</div>

    <div class="row"><span>Engine Start</span><span>${minutesToHHMM(engine)}</span></div>
    <div class="subtext">T/O − 0+30</div>

    <div class="row"><span>Takeoff</span><span>${minutesToHHMM(takeoffMin)}</span></div>
    <div class="subtext">T/O − 0+00</div>

    <hr>

    <div class="row"><span>Flight Time</span><span>${flightHrs} hrs</span></div>

    <hr>

    <div style="font-weight:bold;font-size:18px;text-align:center;">Duty Limitations</div>

    <div class="row ${hl(fdp)}"><span>Flight Duty Period Ends</span><span>${minutesToHHMM(showTime+fdp)}</span></div>
    <div class="subtext">Show + ${fdp/60}+00</div>

    <div class="row ${hl(cdp)}"><span>Crew Duty Period Ends</span><span>${minutesToHHMM(showTime+cdp)}</span></div>
    <div class="subtext">Show + ${(cdp/60).toFixed(2)}+00</div>

    <div class="row"><span>Transition Duty Period Ends</span><span>${minutesToHHMM(showTime+tdp)}</span></div>
    <div class="subtext">Show + 12+00</div>

    <div class="row ${hl(apu)}"><span>Autopilot INOP FDP Ends</span><span>${minutesToHHMM(showTime+apu)}</span></div>
    <div class="subtext">Show + ${apu/60}+00</div>
  `;
}

const augmentedBox = document.getElementById("augmented");
const basicLbl = document.getElementById("basicLbl");
const augLbl = document.getElementById("augLbl");

augmentedBox.addEventListener("change", () => {
  basicLbl.classList.toggle("active", !augmentedBox.checked);
  augLbl.classList.toggle("active", augmentedBox.checked);
  calculate();
});

document.getElementById("calcBtn").addEventListener("click", calculate);
</script>

</div>
</body>
</html>
